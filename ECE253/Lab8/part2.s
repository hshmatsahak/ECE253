LDR R0, =0xFF200000 //leds
LDR R1, =0xFFFEC600 //timer
LDR R2, =0xFF200050 //KEYS
LDR R3, =49999999	
STR R3, [R1]
MOV R3, #0x3 // enable, autoreload
STR R3, [R1, #8]
LDR R4, =0x00000201
MOV R7, #0
LOOP:
    STR R4, [R0]
WAITFORPRESS:
    LDR R5, [R2]
    CMP R5, #0
    BNE WAITFORRELEASE
DELAY:
    LDR R3, [R1, #12]
    CMP R3, #0
	BNE TRANSITION
	CMP R5, #0
	BEQ WAITFORPRESS
	B WAITFORRELEASE
TRANSITION:
    STR R3, [R1, #12]
    CMP R7, #0 //R7=0 --> TOWARDS
    BNE AWAY
TOWARDS:
	LDR R6, =0x0030
    CMP R4, R6
    BEQ AWAY
    MOV R7, #0
    AND R8, R4, #0x000003E0
    LSR R8, R8, #1
    AND R9, R4, #0x0000001F
    LSL R9, R9, #1
    ADD R4, R8, R9
    B LOOP
AWAY:
	LDR R6, =0x0201
    CMP R4, R6
    BEQ TOWARDS
    MOV R7, #1
    AND R8, R4, #0x000003E0
    LSL R8, R8, #1
    AND R9, R4, #0x0000001F
    LSR R9, R9, #1
    ADD R4, R8, R9
    B LOOP
WAITFORRELEASE:
    LDR R5, [R2]
    CMP R5, #0
    BNE DELAY
STALLRELEASED:
    LDR R5, [R2]
    CMP R5, #0
    BEQ STALLRELEASED
STALLPRESSED:
    LDR R5, [R2]
    CMP R5, #0
    BNE STALLPRESSED
	LDR R3, =49999999	
	STR R3, [R1]
	MOV R3, #0x3
	STR R3, [R1, #8]
	MOV R3, #1
	STR R3, [R1, #12]
DELAY2:
    LDR R3, [R1, #12]
    CMP R3, #0
	BEQ DELAY2
    B LOOP




